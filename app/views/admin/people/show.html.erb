<div class="max-w-4xl mx-auto px-4 py-8">
  <div class="mb-6">
    <%= link_to "← Back to People", admin_people_path, class: "text-blue-600 hover:text-blue-800" %>
  </div>

  <!-- Person Header -->
  <div class="bg-white rounded-lg shadow mb-6">
    <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
      <div>
        <h1 class="text-2xl font-bold text-gray-900"><%= @person.full_name %></h1>
        <p class="text-gray-600">
          <%= @person.primary_party&.name || "No party" %> · 
          <%= @person.state_of_residence || "Unknown state" %>
        </p>
      </div>
      <div class="flex items-center gap-2">
        <%= link_to "Edit", edit_admin_person_path(@person), class: "px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300" %>
        <%= button_to "Prepopulate Accounts", prepopulate_accounts_admin_person_path(@person), method: :post, class: "px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700" %>
      </div>
    </div>
  </div>

  <div class="grid md:grid-cols-2 gap-6">
    <!-- Assign Researcher -->
    <div class="bg-white rounded-lg shadow">
      <div class="px-6 py-4 border-b border-gray-200">
        <h2 class="text-xl font-semibold text-gray-900">Assign Researcher</h2>
      </div>
      <div class="p-6">
        <%= form_with url: assign_researcher_admin_person_path(@person), method: :post, class: "space-y-4" do |f| %>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Researcher</label>
            <%= select_tag :user_id, options_from_collection_for_select(User.researchers.order(:name), :id, :name), prompt: "Select researcher...", class: "w-full px-3 py-2 border border-gray-300 rounded-md", required: true %>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Task Type</label>
            <%= select_tag :task_type, options_for_select([['Data Collection - Find accounts', 'data_collection'], ['Data Validation - Verify accounts', 'data_validation']]), class: "w-full px-3 py-2 border border-gray-300 rounded-md" %>
          </div>
          <div>
            <%= submit_tag "Assign", class: "w-full px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 cursor-pointer" %>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Current Assignments -->
    <div class="bg-white rounded-lg shadow">
      <div class="px-6 py-4 border-b border-gray-200">
        <h2 class="text-xl font-semibold text-gray-900">Current Assignments</h2>
      </div>
      <div class="divide-y divide-gray-200">
        <% if @assignments.any? %>
          <% @assignments.each do |assignment| %>
            <div class="px-6 py-4">
              <div class="flex justify-between items-center">
                <div>
                  <div class="font-medium"><%= assignment.user.name %></div>
                  <div class="text-sm text-gray-600">
                    <%= assignment.task_type.humanize %> · 
                    Assigned by <%= assignment.assigned_by.name %>
                  </div>
                </div>
                <%= assignment_status_badge(assignment.status) %>
              </div>
            </div>
          <% end %>
        <% else %>
          <div class="px-6 py-4 text-gray-500 text-center">No assignments yet</div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Social Media Accounts -->
  <div class="bg-white rounded-lg shadow mt-6">
    <div class="px-6 py-4 border-b border-gray-200">
      <h2 class="text-xl font-semibold text-gray-900">Social Media Accounts</h2>
    </div>
    <div class="divide-y divide-gray-200">
      <% if @accounts.any? %>
        <% @accounts.group_by(&:channel_type).each do |channel_type, accounts| %>
          <div class="px-6 py-3 bg-gray-50">
            <span class="font-medium text-gray-700"><%= channel_type.humanize %> Accounts</span>
          </div>
          <% accounts.each do |account| %>
            <div class="px-6 py-4 flex justify-between items-center">
              <div class="flex items-center gap-3">
                <%= platform_icon(account.platform, size: 20) %>
                <div>
                  <div class="font-medium"><%= account.platform %></div>
                  <% if account.url.present? || account.handle.present? %>
                    <div class="text-sm text-gray-600"><%= account.url.presence || "@#{account.handle}" %></div>
                  <% elsif account.pre_populated? %>
                    <div class="text-sm text-gray-400 italic">Awaiting research</div>
                  <% end %>
                </div>
              </div>
              <div class="flex items-center gap-2">
                <%= research_status_badge(account.research_status) %>
                <% if account.entered_by %>
                  <span class="text-xs text-gray-500">by <%= account.entered_by.name %></span>
                <% end %>
                <% if account.verified_by %>
                  <span class="text-xs text-green-600">✓ <%= account.verified_by.name %></span>
                <% end %>
              </div>
            </div>
          <% end %>
        <% end %>
      <% else %>
        <div class="px-6 py-8 text-center text-gray-500">
          No accounts yet. 
          <%= button_to "Prepopulate accounts", prepopulate_accounts_admin_person_path(@person), method: :post, class: "text-blue-600 hover:text-blue-800" %>
        </div>
      <% end %>
    </div>
  </div>
</div>
