<div class="max-w-7xl mx-auto px-4 py-8">
  <div class="mb-6">
    <%= link_to "← Back to People", admin_people_path, class: "text-blue-600 hover:text-blue-800" %>
  </div>

  <h1 class="text-3xl font-bold text-gray-900 mb-6">Bulk Assign Researchers</h1>

  <%= form_with url: create_bulk_assignments_admin_people_path, method: :post, class: "space-y-6" do |f| %>
    <!-- Assignment Settings -->
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Assignment Settings</h2>
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Researcher</label>
          <%= select_tag :user_id, options_from_collection_for_select(@researchers, :id, :name), prompt: "Select researcher...", class: "w-full px-3 py-2 border border-gray-300 rounded-md", required: true %>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Task Type</label>
          <%= select_tag :task_type, options_for_select([['Data Collection - Find accounts', 'data_collection'], ['Data Validation - Verify accounts', 'data_validation']]), class: "w-full px-3 py-2 border border-gray-300 rounded-md" %>
        </div>
      </div>
    </div>

    <!-- People Selection -->
    <div class="bg-white rounded-lg shadow">
      <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
        <h2 class="text-xl font-semibold text-gray-900">Select People</h2>
        <div class="text-sm text-gray-600">
          <label class="flex items-center gap-2">
            <input type="checkbox" id="selectAll" class="rounded border-gray-300">
            <span>Select all on this page</span>
          </label>
        </div>
      </div>
      <div class="divide-y divide-gray-200 max-h-[500px] overflow-y-auto">
        <% @people.each do |person| %>
          <label class="px-6 py-3 flex items-center gap-3 hover:bg-gray-50 cursor-pointer">
            <%= check_box_tag "person_ids[]", person.id, false, class: "person-checkbox rounded border-gray-300" %>
            <div class="flex-1">
              <div class="font-medium"><%= person.full_name %></div>
              <div class="text-sm text-gray-600">
                <%= person.primary_party&.name || "No party" %> · <%= person.state_of_residence || "Unknown" %>
              </div>
            </div>
            <% if person.assignments.active.any? %>
              <span class="text-xs text-yellow-600">Already assigned</span>
            <% end %>
          </label>
        <% end %>
      </div>
    </div>

    <div class="flex justify-end">
      <%= submit_tag "Create Assignments", class: "px-6 py-3 bg-blue-600 text-white rounded hover:bg-blue-700 cursor-pointer" %>
    </div>
  <% end %>

  <div class="mt-4">
    <%= paginate @people %>
  </div>
</div>

<script>
  document.getElementById('selectAll').addEventListener('change', function() {
    document.querySelectorAll('.person-checkbox').forEach(cb => cb.checked = this.checked);
  });
</script>
